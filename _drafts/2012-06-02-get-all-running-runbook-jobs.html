---
layout: post
title: Get all Running Runbook Jobs
date: '2012-06-02T04:27:00.001-07:00'
author: Jon Mattivi
tags:
- edm.guid
- scorch
- System Center Orchestrator 2012
- xml  More stats
- guid
- filter runbooks
- PowerShell
- Orchestrator
- GET Request
- Orchestrator Web Service
- orchestrator.svc
- odata
modified_time: '2012-06-06T11:41:13.080-07:00'
blogger_id: tag:blogger.com,1999:blog-603465820850819373.post-3174606743280457125
blogger_orig_url: http://jmattivi.blogspot.com/2012/06/get-all-running-runbook-jobs.html
---

This post I'll show how to get all Running Runbook jobs.<br /><br />I used the ConvertTo-SCOObject function Robert Hearn posted here to parse the xml response from the GET call.<br /><br />#########################################################################<br /><br />function ConvertTo-SCOObject {<br />[CmdletBinding()]<br />PARAM (<br />[Parameter(Mandatory=$true)]<br />[String] $XmlFeed<br />)<br />$xml =[xml]$XmlFeed<br /><br />$ns = New-Object Xml.XmlNamespaceManager $xml.NameTable<br />$ns.AddNamespace( "d", "http://schemas.microsoft.com/ado/2007/08/dataservices")<br />$ns.AddNamespace( "m", "http://schemas.microsoft.com/ado/2007/08/dataservices/metadata")<br />$ns.AddNamespace( "def", "http://www.w3.org/2005/Atom")<br /><br />$objarray = @()<br /><br />$entryNodes = $xml.SelectNodes("//def:entry",$ns)<br />foreach ($entryNode in $entryNodes)<br />{<br />$obj = New-Object PSObject<br />$objectType = $entryNode.SelectSingleNode(".//def:category", $ns).GetAttribute("term")<br /><br />$obj | add-member Noteproperty -Name "Object Type" -Value $objectType.Split(".")[-1]<br /><br />$propertiesNode = $entryNode.SelectSingleNode(".//m:properties", $ns)<br />foreach($propertyNode in $propertiesNode.ChildNodes)<br />{<br />$obj | add-member Noteproperty -Name $propertyNode.LocalName -Value $propertyNode.get_InnerText()<br />}<br /><br />$links = $entryNode.SelectNodes(".//def:link", $ns)<br />foreach ($link in $links)<br />{<br />$obj | add-member NoteProperty -Name $link.title -Value $link.href<br />}<br />$objarray += $obj<br />}<br /><br />return $objarray<br /><br />#########################################################################<br /><br />Due to the paging limits on the web service collections (Jobs being 500), I used this method for filtering the results.&nbsp; The most important part of this GET is building the query into the odata URI.&nbsp; You can build in filters, select statements, etc. on the Web Service collections shown like this.<br /><br />http://scorch.domain:81/Orchestrator2012/Orchestrator.svc/Jobs()?$filter=Status eq 'Running'<br />\_______________________________________________________/ \____/&nbsp; \_________________________/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; service root URI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; resource path&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; query options<br /><br />Putting this into practice w/ SCOrch, you can query the Jobs collection, filter for Jobs that have a Status of "Running", and select the fields you would like to return â€“ Id,RunbookId,LastModifiedTime,Status.<br /><br />"http://scorch.domain:81/Orchestrator2012/Orchestrator.svc/Jobs()?`$filter=Status eq 'Running'&amp;`$select=Id,RunbookId,LastModifiedTime,Status"<br /><br />So you can use this on any of the collections to filter results i.e. Jobs, Runbooks, RunbookInstances, Statistics, etc.<br /><br />The GET request would look like this.<br /><br />$creds = Get-Credential("domain\username")<br /><br />$XmlFeed = $null<br />$count = 0<br />$url = "http://scorch.domain:81/Orchestrator2012/Orchestrator.svc/Jobs()?`$filter=Status eq 'Running'&amp;`$select=Id,RunbookId,LastModifiedTime,Status"<br />$request = [System.Net.HttpWebRequest]::Create($url)<br />$request.Credentials = $creds<br />$request.Timeout = 60000<br />$request.ContentType = "application/atom+xml,application/xml"<br />$request.Method = "GET"<br /><br />$response = $request.GetResponse()<br />$requestStream = $response.GetResponseStream()<br />$readStream=new-object System.IO.StreamReader $requestStream<br />$XmlFeed = $readStream.ReadToEnd()<br />$readStream.Close()<br />$response.Close()<br /><br />Using the ConvertTo-SCOObject function, you can then parse the response and set your variables and get a count of the running runbooks.<br /><br />ConvertTo-SCOObject -XmlFeed $XmlFeed | %{$count++}<br />$Id = ConvertTo-SCOObject -XmlFeed $XmlFeed | %{$_.Id}<br />$RunbookId = ConvertTo-SCOObject -XmlFeed $XmlFeed | %{$_.RunbookId}<br />$LastModifiedTime = ConvertTo-SCOObject -XmlFeed $XmlFeed | %{$_.LastModifiedTime}<br />$Status = ConvertTo-SCOObject -XmlFeed $XmlFeed | %{$_.Status}<br /><br />Here is the complete script for getting all Running Runbook Jobs.&nbsp; Highlighted fields would need to be updated per your environment.<br /><br />##########################################################################################################<br />function ConvertTo-SCOObject {<br />[CmdletBinding()]<br />PARAM (<br />[Parameter(Mandatory=$true)]<br />[String] $XmlFeed<br />)<br />$xml =[xml]$XmlFeed<br /><br />$ns = New-Object Xml.XmlNamespaceManager $xml.NameTable<br />$ns.AddNamespace( "d", "http://schemas.microsoft.com/ado/2007/08/dataservices")<br />$ns.AddNamespace( "m", "http://schemas.microsoft.com/ado/2007/08/dataservices/metadata")<br />$ns.AddNamespace( "def", "http://www.w3.org/2005/Atom")<br /><br />$objarray = @()<br /><br />$entryNodes = $xml.SelectNodes("//def:entry",$ns)<br />foreach ($entryNode in $entryNodes)<br />{<br />$obj = New-Object PSObject<br />$objectType = $entryNode.SelectSingleNode(".//def:category", $ns).GetAttribute("term")<br /><br />$obj | add-member Noteproperty -Name "Object Type" -Value $objectType.Split(".")[-1]<br /><br />$propertiesNode = $entryNode.SelectSingleNode(".//m:properties", $ns)<br />foreach($propertyNode in $propertiesNode.ChildNodes)<br />{<br />$obj | add-member Noteproperty -Name $propertyNode.LocalName -Value $propertyNode.get_InnerText()<br />}<br /><br />$links = $entryNode.SelectNodes(".//def:link", $ns)<br />foreach ($link in $links)<br />{<br />$obj | add-member NoteProperty -Name $link.title -Value $link.href<br />}<br />$objarray += $obj<br />}<br /><br />return $objarray<br />}<br /><br />$creds = Get-Credential("<span style="background-color: yellow; color: black;">domain\username</span>")<br /><br />$XmlFeed = $null<br />$count = 0<br />$url = "<span style="background-color: yellow; color: black;">http://scorch.domain:81</span>/Orchestrator2012/Orchestrator.svc/Jobs()?`$filter=Status eq 'Running'&amp;`$select=Id,RunbookId,LastModifiedTime,Status"<br />$request = [System.Net.HttpWebRequest]::Create($url)<br />$request.Credentials = $creds<br />$request.Timeout = 60000<br />$request.ContentType = "application/atom+xml,application/xml"<br />$request.Method = "GET"<br /><br />$response = $request.GetResponse()<br />$requestStream = $response.GetResponseStream()<br />$readStream=new-object System.IO.StreamReader $requestStream<br />$XmlFeed = $readStream.ReadToEnd()<br />$readStream.Close()<br />$response.Close()<br /><br />ConvertTo-SCOObject -XmlFeed $XmlFeed | %{$count++}<br />$Id = ConvertTo-SCOObject -XmlFeed $XmlFeed | %{$_.Id}<br />$RunbookId = ConvertTo-SCOObject -XmlFeed $XmlFeed | %{$_.RunbookId}<br />$LastModifiedTime = ConvertTo-SCOObject -XmlFeed $XmlFeed | %{$_.LastModifiedTime}<br />$Status = ConvertTo-SCOObject -XmlFeed $XmlFeed | %{$_.Status}<br />##########################################################################################################<br /><br />A few good resources for working with the Orchestrator Web Service.<br /><br /><a href="http://blogs.technet.com/b/scorch/archive/2011/06/17/fun-with-the-orchestrator-2012-beta-the-web-service-and-powershell.aspx">http://blogs.technet.com/b/scorch/archive/2011/06/17/fun-with-the-orchestrator-2012-beta-the-web-service-and-powershell.aspx</a><br /><br /><a href="http://www.odata.org/developers/protocols/uri-conventions">http://www.odata.org/developers/protocols/uri-conventions</a>