---
layout: post
title: Stopping (Canceling) a Runbook Job w/ Powershell
date: '2012-06-02T04:12:00.000-07:00'
author: Jon Mattivi
tags:
- guid
- Stop Runbook
- PowerShell
- edm.guid
- Orchestrator
- Orchestrator Web Service
- scorch
- xml
- System Center Orchestrator 2012
- orchestrator.svc
- Cancel Runbook
modified_time: '2012-06-06T11:41:37.667-07:00'
blogger_id: tag:blogger.com,1999:blog-603465820850819373.post-4021673192222020440
blogger_orig_url: http://jmattivi.blogspot.com/2012/06/stopping-canceling-runbook-job-w.html
---

Canceling a runbook job requires a few more options in the headers and payload of the request.&nbsp; There are three properties of the job that you must use to&nbsp; cancel the runbook.<br /><br /><span style="color: red;">$JobID</span> = "10000000-0000-0000-0000-000000000000"<br /><span style="color: red;">$RunbookID</span> = "00000000-1000-0000-0000-000000000000"<br /><span style="color: red;">$LastModifiedTime</span> = "2012-01-10T13:44:36.823"<br /><br />First, the url must point to the specific job guid that you intend to stop.<br /><br />$url = "http://scorch.domain:81/Orchestrator2012/Orchestrator.svc/Jobs(guid'<span style="color: red;">$JobID</span>')"<br /><br />Second, the request headers also require a few more options than a regular GET or POST to start a Runbook.<br /><br />$request.Headers.Add("X-HTTP-Method", "MERGE")<br />$request.Headers.Add("If-Match", 'W/"datetime' + "'" + <span style="color: red;">$LastModifiedTime</span> + "'" + '"')<br /><br />Third, the payload needs to include these fields in the properties struct:&nbsp; JobID, RunbookID, and Status = Canceled.<br /><br />"&lt;m:properties&gt;" + "`n" +<br />'&lt;d:Id m:type="Edm.Guid"&gt;' + <span style="color: red;">$JobID</span> + '&lt;/d:Id&gt;' + "`n" +<br />'&lt;d:RunbookId m:type="Edm.Guid"&gt;' + <span style="color: red;">$RunbookID</span> + '&lt;/d:RunbookId&gt;' + "`n" +<br />"&lt;d:Status&gt;<span style="color: red;">Canceled</span>&lt;/d:Status&gt;" + "`n" +<br />"&lt;/m:properties&gt;" + "`n" +<br /><br />Here is the complete script to cancel a specific Job.&nbsp; Fields in red would need to be updated per your environment.<br /><br />###############################################################################################################<br /><div style="color: #cccccc;">$creds = Get-Credential("<span style="background-color: yellow; color: black;">domain\username</span>")</div><div style="color: #cccccc;"><br /></div><div style="color: #cccccc;">$JobID = "<span style="background-color: yellow; color: black;">10000000-0000-0000-0000-000000000000</span>"</div><div style="color: #cccccc;">$RunbookID = "<span style="background-color: yellow; color: black;">00000000-1000-0000-0000-000000000000</span>"</div><div style="color: #cccccc;">$LastModifiedTime = "<span style="background-color: yellow; color: black;">2012-01-10T13:44:36.823</span>"</div><div style="color: #cccccc;"><br /></div><div style="color: #cccccc;">$url = "<span style="background-color: yellow; color: black;">http://scorch.domain:81</span>/Orchestrator2012/Orchestrator.svc/Jobs(guid'$JobID')"</div><div style="color: #cccccc;">$request = [System.Net.HttpWebRequest]::Create($url)</div><div style="color: #cccccc;">$request.Credentials = $creds</div><div style="color: #cccccc;">$request.Timeout = 60000</div><div style="color: #cccccc;">$request.Accept = "application/atom+xml,application/xml"</div><div style="color: #cccccc;">$request.Headers.Add("Accept-Charset", "UTF-8")</div><div style="color: #cccccc;">$request.Headers.Add("X-HTTP-Method", "MERGE")</div><div style="color: #cccccc;">$request.Headers.Add("If-Match", 'W/"datetime' + "'" + $LastModifiedTime + "'" + '"')</div><div style="color: #cccccc;">$request.ContentType = "application/atom+xml"</div><div style="color: #cccccc;">$request.Method = "POST"</div><div style="color: #cccccc;"><br /></div><div style="color: #cccccc;">$requestBody = '&lt;?xml version="1.0" encoding="utf-8" standalone="yes"?&gt;' + "`n" +</div><div style="color: #cccccc;">'&lt;entry xmlns:d="http://schemas.microsoft.com/ado/2007/08/dataservices" xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata" xmlns="http://www.w3.org/2005/Atom"&gt;' + "`n" +</div><div style="color: #cccccc;">'&lt;content type="application/xml"&gt;' + "`n" +</div><div style="color: #cccccc;">"&lt;m:properties&gt;" + "`n" +</div><div style="color: #cccccc;">'&lt;d:Id m:type="Edm.Guid"&gt;' + $JobID + '&lt;/d:Id&gt;' + "`n" +</div><div style="color: #cccccc;">'&lt;d:RunbookId m:type="Edm.Guid"&gt;' + $RunbookID + '&lt;/d:RunbookId&gt;' + "`n" +</div><div style="color: #cccccc;">"&lt;d:Status&gt;Canceled&lt;/d:Status&gt;" + "`n" +</div><div style="color: #cccccc;">"&lt;/m:properties&gt;" + "`n" +</div><div style="color: #cccccc;">"&lt;/content&gt;" + "`n" +</div><div style="color: #cccccc;">"&lt;/entry&gt;"</div><div style="color: #cccccc;"><br /></div><div style="color: #cccccc;">$requeststream=new-object System.IO.StreamWriter $request.GetRequestStream()</div><div style="color: #cccccc;">$requeststream.Write($requestBody)</div><div style="color: #cccccc;">$requeststream.Flush()</div><div style="color: #cccccc;">$requeststream.Close()</div><div style="color: #cccccc;"><br /></div><div style="color: #cccccc;">$response=$request.GetResponse()</div><div style="color: #cccccc;">$requestStream=$response.GetResponseStream()</div><div style="color: #cccccc;">$readStream=new-object System.IO.StreamReader $requestStream</div><div style="color: #cccccc;">$Output=$readStream.ReadToEnd()</div><div style="color: #cccccc;">$readStream.Close()</div><div style="color: #cccccc;">$response.Close()</div>#######################################################################################################